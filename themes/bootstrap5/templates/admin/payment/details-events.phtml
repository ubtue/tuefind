<?=$this->component('page-title', ['title' => $this->translate('Payment::Events'), 'level' => 2, 'lightboxLevel' => 3]);?>

<table class="table table-striped">
  <thead>
    <tr>
      <th><?=$this->transEsc('Payment::Date')?></th>
      <th><?=$this->transEsc('Payment::Server IP')?></th>
      <th><?=$this->transEsc('Payment::Server Name')?></th>
      <th><?=$this->transEsc('Payment::Request')?></th>
      <th><?=$this->transEsc('Payment::Message')?></th>
      <th><?=$this->transEsc('Payment::Details')?></th>
  </thead>
  <tbody>
    <?php foreach ($this->paymentEvents as $event): ?>
      <tr>
        <td>
          <time datetime="<?=$this->escapeHtmlAttr($event->getDate()->format('Y-m-d\TH:i:s'))?>">
            <span title="<?=$this->escapeHtmlAttr($event->getDate()->format('Y-m-d H:i:s'))?>"><?=$this->dateTime()->convertToDisplayDateAndTime('U', $event->getDate()->getTimestamp())?>
          </time>
        </td>
        <td>
          <?=$this->escapeHtml($event->getServerIp())?>
        </td>
        <td>
          <?=$this->escapeHtml($event->getServerName())?>
        </td>
        <td>
          <?=$this->escapeHtml(json_decode($event->getData(), true)['__request_uri'] ?? '')?>
        </td>
        <td>
          <?=$this->transEsc('Payment::' . $event->getMessage())?>
        </td>
        <td>
          <?php
            if ($data = $event->getData()) {
              $details = json_decode($data, true);
              if ($error = $details['error'] ?? null) {
                echo $this->transEsc("Payment::$error");
              }
            }
          ?>
        </td>
      </tr>
    <?php endforeach;?>
  </tbody>
</table>
