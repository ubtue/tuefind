<?php
    // Set default value if necessary:
    if (!isset($this->searchClassId)) {
        $config = $this->config()->get('config');
        $this->searchClassId = $config->Site->defaultSearchBackend ?? 'Solr';
    }

    // Load search actions and settings (if any):
    $options = $this->searchOptions($this->searchClassId);
    $handlers = $this->searchbox()->getHandlers(
        $this->searchClassId, $this->searchIndex ?? null
    );
    $handlerCount = count($handlers);
    $basicSearch = $this->searchbox()->combinedHandlersActive() ? 'combined-searchbox' : $options->getSearchAction();
    $searchHome = $options->getSearchHomeAction();
    $advSearch = $options->getAdvancedSearchAction();
    $lastSort = $this->searchMemory()->getLastSort($this->searchClassId);
    $lastLimit = $this->searchMemory()->getLastLimit($this->searchClassId);
    $ignoreHiddenFilterMemory = $this->ignoreHiddenFilterMemory ?? false;
    $ignoreHiddenFiltersInRequest = $this->ignoreHiddenFiltersInRequest ?? false;
    $hiddenFilters = $this->searchTabs()->getHiddenFilters($this->searchClassId, $ignoreHiddenFilterMemory, $ignoreHiddenFiltersInRequest);
    if (empty($hiddenFilters) && !$ignoreHiddenFilterMemory) {
        $hiddenFilters = $this->searchMemory()->getLastHiddenFilters($this->searchClassId);
        if (empty($hiddenFilters)) {
            $hiddenFilters = $this->searchTabs()->getHiddenFilters($this->searchClassId);
        }
    }
    $hiddenFilterParams = $this->searchTabs()->getCurrentHiddenFilterParams($this->searchClassId, $ignoreHiddenFilterMemory, '?');

    if (!isset($this->filterList) || !isset($this->checkboxFilters)) {
        $params = $this->searchMemory()->getLastSearchParams($this->searchClassId);
        $filterList = $params->getFilterList(true);
        $checkboxFilters = $params->getCheckboxFacets();
    } else {
        $filterList = is_array($this->filterList) ? $this->filterList : [];
        $checkboxFilters = is_array($this->checkboxFilters) ? $this->checkboxFilters : [];
    }
    $filterDetails = $this->searchbox()->getFilterDetails($filterList, $checkboxFilters);
    $showFilters = $filterDetails && (isset($results) || $options->getRetainFilterSetting());
?>
<?php $tabConfig = $this->searchTabs()->getTabConfig($this->searchClassId, $this->lookfor, $this->searchIndex, $this->searchType, $hiddenFilters); ?>

<div class="row tf-row-home_">
    <!--  Begin section searchbar -->
    <section class="section-home">
        <div class="panel-home">
            <?=$this->inlineScript(\Laminas\View\Helper\HeadScript::SCRIPT, 'TueFind2.ChangeSearchboxHeight();', 'SET')?>

            <div class="visible-lg visible-md visible-sm">
                <h1>
                    <a href="<?=$this->url('home')?>" title="Index Theologicus">Index Theologicus</a>
                </h1>
                <small><?=$this->transEsc("ixtheo_subtitle")?></small>
                <br />

                <?php $routeParams = $this->tuefind()->getRouteParams(); print_r($routeParams);
                    if($routeParams['controller'] != "index" && $routeParams['action'] != "Home") {
                      echo $this->render('search/searchboxForm');
                    }?>

            </div>

            <div class="searchbox col-12 mx-auto">

                <?=$this->render('search/searchbox/title');?>
                <!-- Begin warnings -->
                <?php if ($this->ils()->getOfflineMode() == "ils-offline"): ?>
                    <div class="alert alert-warning">
                        <h2><?= $this->transEsc('ils_offline_title') ?></h2>

                        <p><strong><?= $this->transEsc('ils_offline_status') ?></strong></p>

                        <p><?= $this->transEsc('ils_offline_home_message') ?></p>
                        <?php $supportEmail = $this->escapeHtmlAttr($this->systemEmail()); ?>
                        <p><a href="mailto:<?= $supportEmail ?>"><?= $supportEmail ?></a></p>
                    </div>
                <?php endif; ?>
                <!-- End warnings -->
            </div><!-- close container -->
            <!--
            <div class="scroll-down" id="scroll-down">
                <a href="" id="scroll-down-button"><span></span><?php $this->transEsc("Scroll"); ?></a>
            </div>
            -->
        </div><!-- close panel-home -->
        <?php //optional extension template, e.g. for IxTheo2-carousel ?>
        <?=$this->render('search/searchbox/section-home-extensions');?>
    </section>
</div>
<!-- End section searchbar -->
