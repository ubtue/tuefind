<?php
    $this->layout()->breadcrumbs = false;
    $this->backgroundTabs = $this->BackgroundTabs ?? [];
    $schemaOrgType = $this->authority()->getSchemaOrgType($this->driver);

    // TueFind:
    // - record.js is needed for AJAX tab logic
    // - disabled, because we use the non-ajax-version.
    // - see also "recordDocReady" at the bottom of this file.
    //$this->headScript()->appendFile("record.js");
?>

<?php /* User Authority Access */ ?>
<?php if ($this->user != false && $this->accountCapabilities()->getRequestAuthorityRightsSetting() === 'enabled'): ?>
  <div>
    <?php if ($this->user_access['availability'] == 'free'): ?>
      <a class="save-record toolbar-btn btn-type-save" rel="nofollow" href="<?=$this->url('authority-request-access', ['authority_id' => $this->driver->getUniqueId()])?>" data-lightbox="">Request access rights (This is me!)</a>
    <?php elseif ($this->user_access['availability'] == 'mine' && $this->user_access['access_state'] == 'requested'): ?>
      You have requested permission on this authority record. Our team has been informed, please wait for the approval.
    <?php elseif ($this->user_access['availability'] == 'mine' && $this->user_access['access_state'] == 'granted'): ?>
      This authority record is linked to your user account.
      <?php if ($this->user != false && $this->accountCapabilities()->getPublicationSetting() === 'enabled'): ?>
        <br><a href="<?=$this->url('myresearch-publish')?>">Would you like to publish something?</a>
      <?php endif; ?>
    <?php endif; ?>
  </div>
<?php endif; ?>

<?php /* Record details */ ?>
<div vocab="http://schema.org/" typeof="<?=$schemaOrgType?>">
  <h3><?=$this->authority()->getName($this->driver)?></h3>
  <?php if ($this->driver->isName()): ?>
    <p><?=$this->transEsc('authority_note_name_record')?></p>
  <?php endif; ?>

  <!-- Here sidebar-right is before mainbody-left, because we want to show the image before the details in responsive behaviour -->
  <div class="sidebar right hidden-print">
    <?php if ($this->driver->getType() == 'person' && !$this->driver->isFamily()): ?>
      <?=$this->context($this)->renderInContext('authority/record/image', ['driver' => $this->driver])?>
    <?php endif; ?>
  </div>
  <div class="mainbody left">
    <?=$this->context($this)->renderInContext('authority/record/details', ['driver' => $this->driver])?>
  </div>

  <div class="mainbody left">
    <?=$this->context($this)->renderInContext('Related/AuthorityTitlesBy', ['driver' => $this->driver])?>
    <?=$this->context($this)->renderInContext('Related/AuthorityTitlesAbout', ['driver' => $this->driver])?>
    <?=$this->context($this)->renderInContext('Related/AuthorityAuthors', ['driver' => $this->driver])?>
    <!-- Graphs -->
    <?=$this->context($this)->renderInContext('Related/AuthorityTopics', ['driver' => $this->driver])?>
    <?=$this->context($this)->renderInContext('Related/AuthorityTimeline', ['driver' => $this->driver])?>

    <?=$this->context($this)->renderInContext('authority/record/tabs', ['driver' => $this->driver])?>
  </div>

  <div class="sidebar right hidden-print">
    <!-- BEACON (Findbuch) references over API proxy -->
    <div class="tf-findbuch-references" data-url="<?=$this->url('findbuchproxy-load')?>?gnd=<?=$this->driver->getGNDNumber()?>" data-headline="<?=$this->transEsc('External Resources')?>"></div>
    <?=$this->inlineScript(\Laminas\View\Helper\HeadScript::SCRIPT, 'TueFind.GetBeaconReferencesFromFindbuch();', 'SET')?>
  </div>
</div>

<?php
  // TueFind:
  // - recordDocReady is needed for AJAX tab logic
  // - disabled, because we use the non-ajax-version.
  // - see also "record.js" at the top of this file.
  // print $this->inlineScript(\Laminas\View\Helper\HeadScript::SCRIPT, '$(document).ready(recordDocReady);', 'SET');
?>
