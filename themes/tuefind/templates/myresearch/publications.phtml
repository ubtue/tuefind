<?php
// Set up page title:
$this->headTitle($this->translate('Publications'));

// Set up breadcrumbs:
$this->layout()->breadcrumbs = '<li><a href="' .  $this->url('myresearch-home') . '">' . $this->transEsc('Your Account') . '</a></li> <li class="active">' . $this->transEsc('Publications') . '</li>';
?>

<div class="<?=$this->layoutClass('mainbody')?>">
  <h2>Authorities</h2>
  <?php if (count($this->authorityRecords) == 0): ?>
    <p>You do not have access to any authority records yet. Please search for an authority record first and request access there.</p>
  <?php else: ?>
    <table class="table">
      <tr>
        <th><?=$this->transEsc('Author')?></th>
        <th><?=$this->transEsc('Status')?></th>
      </tr>
      <?php foreach ($this->authorityUsers as $user): ?>
        <tr>
          <td><a href="/Authority/<?=urlencode($user['id'])?>"><?=$user['title']." (".$user['id'].")";?></a></td>
          <td><?=$user['access_state']?></td>
        </tr>
      <?php endforeach; ?>
    </table>
    <p>If you like to publish something, please search for the matching record which is linked to your authority entry and use the "publish" button in the full view.</p>

    <h2>Publications</h2>
    <?php if (count($this->publications) == 0): ?>
      <p>You did not upload any publications so far.</p>
    <?php else: ?>
      <table class="table">
        <tr>
          <th>ID in external repository</th>
          <th>Title</th>
          <th>Dspace file</th>
          <th>Created</th>
          <th>Terms Date</th>
        </tr>
        <?php foreach ($this->publications as $publication):
          $publicationURL = $this->dspaceServer."/xmlui/handle/".$publication['external_document_id'];
          if($dspaceVersion == 7) {
            $publicationURL = $this->dspaceServer."/items/".$publication['external_document_guid'];
          }?>
          <tr>
            <td><?=$publication['external_document_id']?></td>
            <td><a href="<?=$this->recordLink()->getUrl($publication['control_number'])?>"><?=$publication['title'];?></a></td>
            <td><a href="<?=$publicationURL;?>" target="_blank"><i class="fa fa-external-link"></i> Go to file</a></td>
            <td><?=date("d.m.Y H:i:s",strtotime($publication['publication_datetime']));?></td>
            <td><a href="/publication_terms/terms_<?=date("Ymd",strtotime($publication['terms_date']));?>.pdf" target="_blank"><?=date("d.m.Y",strtotime($publication['terms_date']));?></a></td>
          </tr>
        <?php endforeach; ?>
      </table>
    <?php endif; ?>
  <?php endif; ?>
</div>

<div class="<?=$this->layoutClass('sidebar')?>" id="myresearch-sidebar">
  <?=$this->context($this)->renderInContext("myresearch/menu.phtml", ['active' => 'publications'])?>
</div>
